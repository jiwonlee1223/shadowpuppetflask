{% extends "layout.html" %}

{% block title %}Shadow Puppet AR{% endblock %}

{% block content %}
<!-- 전체 화면 AR 뷰 -->
<div class="fullscreen-ar">
    <!-- 원본 비디오 (숨김) -->
    <video id="webcam" autoplay playsinline style="display: none;"></video>
    
    <!-- 캔버스 (웹캠 입력용) -->
    <canvas id="input-canvas" style="display: none;"></canvas>
    
    <!-- 결과 이미지 + 3D 오버레이 컨테이너 -->
    <div class="ar-container" id="ar-container">
        <!-- 웹캠 배경 이미지 -->
        <img id="output-image" src="" alt="AR 결과">
        
        <!-- Three.js 3D 렌더링 레이어 -->
        <div id="threejs-container"></div>
        
        <!-- 웹캠 대기 오버레이 -->
        <div id="no-video-overlay" class="no-video-overlay">
            <i class="fas fa-camera fa-3x mb-3"></i>
            <h4>웹캠 대기 중...</h4>
            <p>웹캠 접근을 허용해주세요.</p>
        </div>
    </div>
    
    <!-- 하단 컨트롤 바 -->
    <div class="control-bar">
        <button class="btn btn-success" id="btn-start">
            <i class="fas fa-play me-1"></i>시작
        </button>
        <button class="btn btn-danger" id="btn-stop" disabled>
            <i class="fas fa-stop me-1"></i>정지
        </button>
        <span class="badge bg-info ms-3" id="fps-counter">FPS: 0</span>
        <span class="badge bg-secondary ms-2" id="lock-status" style="display: none;">
            <i class="fas fa-unlock me-1"></i>대기
        </span>
    </div>
</div>

<!-- 숨겨진 요소들 (JS 호환용) -->
<div style="display: none;">
    <input type="range" id="threshold-enter" value="0.25">
    <input type="range" id="threshold-exit" value="0.50">
    <input type="range" id="brightness" value="0">
    <input type="range" id="saturation" value="0">
    <span id="threshold-enter-value"></span>
    <span id="threshold-exit-value"></span>
    <span id="brightness-value"></span>
    <span id="saturation-value"></span>
    <button id="btn-reset"></button>
    <button id="btn-reset-adjustment"></button>
    <span id="detection-info"></span>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/socket-handler.js') }}"></script>
<script src="{{ url_for('static', filename='js/three-renderer.js') }}"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}
